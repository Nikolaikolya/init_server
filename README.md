# Утилита настройки сервера на базе Ubuntu 24

Эта утилита автоматизирует процесс первоначальной настройки сервера на базе Ubuntu 24.
Она включает в себя множество функций для обеспечения безопасности, настройки веб-сервера,
создания пользователей, управления Docker и многое другое.

## Возможности

- Настройка нового пользователя с sudo-правами
- Настройка SSH с повышенной безопасностью
- Установка и настройка Docker
- Установка и настройка Nginx через Docker
- Настройка SSL-сертификатов через Certbot
- Настройка GitLab Runners
- Настройка брандмауэра UFW
- Создание и восстановление бэкапов
- Логирование действий в аудит-журнал
- Генерация bash-скриптов для автоматизации процессов

## Требования

- Ubuntu 24 (или совместимый дистрибутив)
- Rust 1.70 или выше
- Права суперпользователя (root)

## Установка

### Одной командой
```bash
curl -o install.sh https://raw.githubusercontent.com/Nikolaikolya/init_server/main/install.sh
chmod +x install.sh
./install.sh
```

### Из исходного кода

```bash
# Клонировать репозиторий
git clone https://github.com/yourusername/bash_script.git
cd bash_script

# Собрать проект
cargo build --release

# Установить бинарный файл
sudo cp target/release/bash_script /usr/local/bin/
```

### Из пакета

```bash
# Скачать последнюю версию
wget https://example.com/download/bash_script_latest.deb

# Установить пакет
sudo dpkg -i bash_script_latest.deb
```

## Использование

### Инициализация сервера

```bash
# В ручном режиме (с интерактивными запросами)
sudo bash_script init

# В автоматическом режиме с указанием параметров
sudo bash_script --auto --user admin --ssh-key "ssh-rsa AAAAB3Nz..." init
```

### Удаление настроек сервера

```bash
sudo bash_script uninstall
```

### Генерация bash-скриптов

```bash
# Генерация скриптов в указанную директорию
sudo bash_script generate-scripts --output-dir /path/to/scripts --backup-dir /path/to/backups
```

## Структура проекта

Проект имеет модульную структуру, что позволяет легко расширять его функциональность:

- `src/main.rs` - Точка входа программы и обработка CLI-аргументов
- `src/server.rs` - Основные функции настройки сервера
- `src/config.rs` - Управление конфигурацией
- `src/utils.rs` - Вспомогательные функции
- `src/docker.rs` - Управление Docker
- `src/nginx.rs` - Настройка Nginx
- `src/security.rs` - Функции безопасности
- `src/backup.rs` - Создание и восстановление бэкапов
- `src/logger.rs` - Логирование событий
- `src/bash_script.rs` - Генерация bash-скриптов

## Аргументы командной строки

| Аргумент | Описание |
|----------|----------|
| `--auto`, `-a` | Автоматический режим настройки |
| `--user`, `-u` | Имя пользователя для создания |
| `--ssh-key` | SSH-ключ для добавления пользователю |
| `--ip-only` | Настройка только для IP (без доменов) |
| `--setup-runners` | Настройка GitLab Runners |

## Генерируемые bash-скрипты

Утилита может генерировать следующие bash-скрипты:

### server-setup.sh

Скрипт для автоматической установки и настройки сервера. Он включает:
- Проверку наличия прав суперпользователя
- Установку необходимых зависимостей
- Скачивание и установку утилиты bash_script
- Запуск процесса настройки сервера с указанными параметрами

### server-update.sh

Скрипт для обновления системы и установленных компонентов:
- Обновление списка пакетов и установленных пакетов
- Обновление Docker-контейнеров
- Обновление SSL-сертификатов
- Удаление неиспользуемых Docker-образов

### server-backup.sh

Скрипт для создания резервных копий конфигурации сервера:
- Останавливает Docker-контейнеры перед бэкапом
- Создает архив с данными сервера
- Запускает контейнеры после бэкапа
- Удаляет старые бэкапы (оставляет только 5 последних)

## Безопасность

Утилита включает следующие функции для обеспечения безопасности:

- Отключение входа по паролю через SSH
- Отключение входа под пользователем root
- Настройка брандмауэра UFW
- Генерация надежных паролей
- Проверка сложности паролей
- Аудит всех выполняемых операций

## Пример конфигурации

```json
{
  "log_level": "info",
  "domains": ["example.com:80", "static.example.com:static"],
  "admin_email": "admin@example.com",
  "packages": [
    "apt-transport-https",
    "ca-certificates",
    "curl",
    "gnupg",
    "lsb-release",
    "software-properties-common",
    "ufw"
  ],
  "package_versions": {},
  "encryption_key": null,
  "encrypt_sensitive_data": true,
  "enable_firewall": true,
  "allowed_ports": [22, 80, 443],
  "docker_version": "latest",
  "nginx_version": "latest",
  "certbot_version": "latest",
  "gitlab_runners": ["runner-1", "runner-2"],
  "is_audit_enabled": true
}
```

## Лицензия

MIT License

## Обратная связь и вклад в проект

Если у вас есть предложения по улучшению утилиты или вы обнаружили ошибку, пожалуйста, создайте issue в репозитории проекта или отправьте pull request с исправлениями.

## Авторы

- Ваше имя - [email@example.com](mailto:email@example.com) 